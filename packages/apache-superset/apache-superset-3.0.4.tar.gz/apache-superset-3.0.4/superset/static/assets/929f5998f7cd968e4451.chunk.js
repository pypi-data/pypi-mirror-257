"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3237,5378],{63295:(t,e,o)=>{o.d(e,{Z:()=>l});var r=o(78918),s=o(71761),i=o(83518),a=o(39450);function n(t,e){const o={};for(const r in t)e.includes(r)||(o[r]=t[r]);return o}class l extends r.Z{initializeState(t){super.initializeState(),this.setState({ignoreProps:n(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:o}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:(0,a.w)(o)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:o,oldProps:r,changeFlags:i}=t,{compareAll:a=!1,dimension:n}=e,{ignoreProps:l}=this.state,{props:p,accessors:c=[]}=n,{updateTriggersChanged:g}=i;if(i.dataChanged)return!0;if(g){if(g.all)return!0;for(const t of c)if(g[t])return!0}if(a)return!!i.extensionsChanged||(0,s.tg)({oldProps:r,newProps:o,ignoreProps:l,propTypes:this.constructor._propTypes});for(const t of p)if(o[t]!==r[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const o in t){e=!1;break}return e}(e)}_getAttributeManager(){return new i.Z(this.context.gl,{id:this.props.id,stats:this.context.stats})}}l.layerName="AggregationLayer"},4516:(t,e,o)=>{o.d(e,{K:()=>r,P:()=>s});const r=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function s(t,e=!1,o=Float32Array){let r;if(Number.isFinite(t[0]))r=new o(t);else{r=new o(4*t.length);let e=0;for(let o=0;o<t.length;o++){const s=t[o];r[e++]=s[0],r[e++]=s[1],r[e++]=s[2],r[e++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let t=0;t<r.length;t++)r[t]/=255;return r}},78918:(t,e,o)=>{o.d(e,{Z:()=>a});var r=o(95772),s=o(63803),i=o(61855);class a extends r.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((t=>t.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){const{_subLayerProps:o}=this.props;return e&&e.length||o&&o[t]}getSubLayerClass(t,e){const{_subLayerProps:o}=this.props;return o&&o[t]&&o[t].type||e}getSubLayerRow(t,e,o){return t.__source={parent:this,object:e,index:o},t}getSubLayerAccessor(t){if("function"==typeof t){const e={data:this.props.data,target:[]};return(o,r)=>o&&o.__source?(e.index=o.__source.index,t(o.__source.object,e)):t(o,r)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:o,visible:r,parameters:s,getPolygonOffset:i,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:p,coordinateOrigin:c,wrapLongitude:g,positionFormat:h,modelMatrix:u,extensions:d,fetch:f,_subLayerProps:y}=this.props,m={opacity:e,pickable:o,visible:r,parameters:s,getPolygonOffset:i,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:p,coordinateOrigin:c,wrapLongitude:g,positionFormat:h,modelMatrix:u,extensions:d,fetch:f},b=y&&y[t.id],_=b&&b.updateTriggers,S=t.id||"sublayer";if(b){const e=this.constructor._propTypes,o=t.type?t.type._propTypes:{};for(const t in b){const r=o[t]||e[t];r&&"accessor"===r.type&&(b[t]=this.getSubLayerAccessor(b[t]))}}Object.assign(m,t,b),m.id="".concat(this.props.id,"-").concat(S),m.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,..._};for(const t of d){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(m,e,{updateTriggers:Object.assign(m.updateTriggers,e.updateTriggers)})}return m}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=(0,i.x)(t,Boolean),this.internalState.subLayers=t),(0,s.Z)("compositeLayer.renderLayers",this,e,t);for(const e of t)e.parent=this}}a.layerName="CompositeLayer"},36665:(t,e,o)=>{o.d(e,{Z:()=>d});var r=o(78580),s=o.n(r),i=o(67294),a=o(45697),n=o.n(a),l=o(51995),p=o(67190),c=o(11965);const g=l.iK.div`
  ${t=>{let{theme:e}=t;return`\n    font-size: ${e.typography.sizes.s}px;\n    position: absolute;\n    background: ${e.colors.grayscale.light5};\n    box-shadow: 0 0 ${e.gridUnit}px ${e.colors.grayscale.light2};\n    margin: ${6*e.gridUnit}px;\n    padding: ${3*e.gridUnit}px ${5*e.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        color: ${e.colors.grayscale.base};\n        text-decoration: none;\n\n        & span {\n          margin-right: ${3*e.gridUnit}px;\n        }\n      }\n    }\n  `}}
`,h=" - ",u={categories:n().object,forceCategorical:n().bool,format:n().string,position:n().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:n().func,toggleCategory:n().func};class d extends i.PureComponent{format(t){if(!this.props.format||this.props.forceCategorical)return t;const e=parseFloat(t);return(0,p.uf)(this.props.format,e)}formatCategoryLabel(t){if(!this.props.format)return t;if(s()(t).call(t,h)){const e=t.split(h);return this.format(e[0])+h+this.format(e[1])}return this.format(t)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const t=Object.entries(this.props.categories).map((t=>{let[e,o]=t;const r={color:`rgba(${o.color.join(", ")})`},s=o.enabled?"◼":"◻";return(0,c.tZ)("li",{key:e},(0,c.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,c.tZ)("span",{style:r},s)," ",this.formatCategoryLabel(e)))})),e={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,c.tZ)(g,{style:e},(0,c.tZ)("ul",null,t))}}d.propTypes=u,d.defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}}},26331:(t,e,o)=>{o.d(e,{B:()=>C,G:()=>S});var r=o(18446),s=o.n(r),i=o(67294),a=o(84502),n=o(45697),l=o.n(n),p=o(28062),c=o(85531),g=o(36665),h=o(64106),u=o(66911),d=o(21207),f=o(40461),y=o(11965);const{getScale:m}=p,b={datasource:l().object.isRequired,formData:l().object.isRequired,getLayer:l().func.isRequired,getPoints:l().func.isRequired,height:l().number.isRequired,mapboxApiKey:l().string.isRequired,onAddFilter:l().func,payload:l().object.isRequired,setControlValue:l().func.isRequired,viewport:l().object.isRequired,width:l().number.isRequired};class _ extends i.PureComponent{constructor(t){super(t),this.containerRef=i.createRef(),this.setTooltip=t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)},this.state=this.getStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(t){t.payload.form_data!==this.state.formData&&this.setState({...this.getStateFromProps(t)})}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getStateFromProps(t,e){const o=t.payload.data.features||[],r=o.map((t=>t.__timestamp)),s=function(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},r=[o.r,o.g,o.b,255*o.a],s=m(t.color_scheme),i={};return e.forEach((e=>{if(null!=e.cat_color&&!i.hasOwnProperty(e.cat_color)){let a;a=t.dimension?(0,h.hexToRGB)(s(e.cat_color,t.sliceId),255*o.a):r,i[e.cat_color]={color:a,enabled:!0}}})),i}(t.formData,o);if(e&&t.payload.form_data===e.formData)return{...e,categories:s};const i=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:a,end:n,getStep:l,values:p,disabled:c}=(0,u.g)(r,i),{width:g,height:d,formData:y}=t;let{viewport:b}=t;return y.autozoom&&(b=(0,f.Z)(b,{width:g,height:d,points:t.getPoints(o)})),b.zoom<0&&(b.zoom=0),{start:a,end:n,getStep:l,values:p,disabled:c,viewport:b,selected:[],lastClick:0,formData:t.payload.form_data,categories:s}}getLayers(t){const{getLayer:e,payload:o,formData:r,onAddFilter:s}=this.props;let i=o.data.features?[...o.data.features]:[];i=this.addColor(i,r),r.js_data_mutator&&(i=(0,d.Z)(r.js_data_mutator)(i)),i=t[0]===t[1]||t[1]===this.end?i.filter((e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1])):i.filter((e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]));const a=this.state.categories;return r.dimension&&(i=i.filter((t=>a[t.cat_color]&&a[t.cat_color].enabled))),[e(r,{...o,data:{...o.data,features:i}},s,this.setTooltip,this.props.datasource)]}addColor(t,e){const o=e.color_picker||{r:0,g:0,b:0,a:1},r=m(e.color_scheme);return t.map((t=>{let s;return e.dimension?(s=(0,h.hexToRGB)(r(t.cat_color,e.sliceId),255*o.a),{...t,color:s}):t}))}toggleCategory(t){const e=this.state.categories[t],o={...this.state.categories,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),this.setState({categories:o})}showSingleCategory(t){const e={...this.state.categories};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,this.setState({categories:e})}render(){return(0,y.tZ)("div",{style:{position:"relative"}},(0,y.tZ)(c.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},(0,y.tZ)(g.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}}function S(t,e){class o extends i.PureComponent{constructor(t){super(t),this.containerRef=i.createRef(),this.setTooltip=t=>{const{current:e}=this.containerRef;e&&(null==e||e.setTooltip(t))};const{width:o,height:r,formData:s}=t;let{viewport:a}=t;s.autozoom&&(a=(0,f.Z)(a,{width:o,height:r,points:e(t.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(t)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(t){const e={...t.formData,viewport:null},o={...this.props.formData,viewport:null};s()(e,o)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})}onViewportChange(t){this.setState({viewport:t})}computeLayer(e){const{formData:o,payload:r,onAddFilter:s}=e;return t(o,r,s,this.setTooltip)}render(){const{formData:t,payload:e,setControlValue:o,height:r,width:s}=this.props,{layer:i,viewport:n}=this.state;return(0,y.tZ)(a.F,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:n,layers:[i],mapStyle:t.mapbox_style,setControlValue:o,width:s,height:r,onViewportChange:this.onViewportChange})}}return o}function C(t,e){return function(o){const{datasource:r,formData:s,height:i,payload:a,setControlValue:n,viewport:l,width:p}=o;return(0,y.tZ)(_,{datasource:r,formData:s,mapboxApiKey:a.data.mapboxApiKey,setControlValue:n,viewport:l,getLayer:t,payload:a,getPoints:e,width:p,height:i})}}_.propTypes=b},2429:(t,e,o)=>{o.r(e),o.d(e,{default:()=>d,getLayer:()=>u});var r=o(42103),s=(o(67294),o(55867)),i=o(45511),a=o(52154),n=o(21207),l=o(64106),p=o(26331),c=o(1740),g=o(11965);function h(t){return(0,g.tZ)("div",{className:"deckgl-tooltip"},(0,g.tZ)(c.Z,{label:(0,s.t)("Centroid (Longitude and Latitude): "),value:`(${null==t?void 0:t.coordinate[0]}, ${null==t?void 0:t.coordinate[1]})`}))}const u=(t,e,o,s)=>{var p,c,g,u;const d=t,{intensity:f=1,radius_pixels:y=30,aggregation:m="SUM",js_data_mutator:b,linear_color_scheme:_}=d;let S=e.data.features;b&&(S=(0,n.Z)(d.js_data_mutator)(S));const C=null==(p=(0,i.Z)())||null==(c=p.get(_))?void 0:c.createLinearScale([0,6]),w=null==C||null==(g=C.range())||null==(u=g.map((t=>(0,l.hexToRGB)(t))))?void 0:u.reverse();return new r.Z({id:`heatmp-layer-${d.slice_id}`,data:S,intensity:f,radiusPixels:y,colorRange:w,aggregation:m.toUpperCase(),getPosition:t=>t.position,getWeight:t=>t.weight?t.weight:1,...(0,a.N)(d,s,h)})},d=(0,p.G)(u,(function(t){return t.map((t=>t.position))}))}}]);
//# sourceMappingURL=929f5998f7cd968e4451.chunk.js.map