"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7001],{81788:(e,t,a)=>{a.d(t,{B8:()=>d,TZ:()=>o,mf:()=>l,u7:()=>i});var s=a(31069),r=a(68492);const n=(e,t,a)=>{let s=`api/v1/dashboard/${e}/filter_state`;return t&&(s=s.concat(`/${t}`)),a&&(s=s.concat(`?tab_id=${a}`)),s},o=(e,t,a,o)=>s.Z.put({endpoint:n(e,a,o),jsonPayload:{value:t}}).then((e=>e.json.message)).catch((e=>(r.Z.error(e),null))),i=(e,t,a)=>s.Z.post({endpoint:n(e,void 0,a),jsonPayload:{value:t}}).then((e=>e.json.key)).catch((e=>(r.Z.error(e),null))),d=(e,t)=>s.Z.get({endpoint:n(e,t)}).then((e=>{let{json:t}=e;return JSON.parse(t.value)})).catch((e=>(r.Z.error(e),null))),l=e=>s.Z.get({endpoint:`/api/v1/dashboard/permalink/${e}`}).then((e=>{let{json:t}=e;return t})).catch((e=>(r.Z.error(e),null)))},57001:(e,t,a)=>{a.r(t),a.d(t,{DashboardPage:()=>le,DashboardPageIdContext:()=>oe,default:()=>ce});var s=a(67294),r=a(11965),n=a(16550),o=a(51995),i=a(93185),d=a(78161),l=a(28062),c=a(55867),u=a(28216),p=a(14114),h=a(38703),f=a(67417),m=a(4305),b=a(50810),g=a(14505),v=a(3935),y=a(61337),S=a(27600),E=a(23525),_=a(52794),I=a(9467),w=a(81788),x=a(14890),R=a(78580),C=a.n(R),D=a(45697),T=a.n(D),$=a(14278),j=a(20292),F=a(81255);function q(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===F.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var U=a(2275),O=a(3741),Z=a(99543),k=a(56967);const M=[F.dW,F.xh,F.t];function L(e){return!Object.values(e).some((e=>{let{type:t}=e;return t&&C()(M).call(M,t)}))}const Q={actions:T().shape({addSliceToDashboard:T().func.isRequired,removeSliceFromDashboard:T().func.isRequired,triggerQuery:T().func.isRequired,logEvent:T().func.isRequired,clearDataMaskState:T().func.isRequired}).isRequired,dashboardInfo:U.$X.isRequired,dashboardState:U.DZ.isRequired,slices:T().objectOf(U.Rw).isRequired,activeFilters:T().object.isRequired,chartConfiguration:T().object,datasources:T().object.isRequired,ownDataCharts:T().object.isRequired,layout:T().object.isRequired,impressionId:T().string.isRequired,initMessages:T().array,timeout:T().number,userId:T().string};class A extends s.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",A.unload):window.removeEventListener("beforeunload",A.unload)}static unload(){const e=(0,c.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,a;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(a=e.ownDataCharts)?a:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=(0,j.Z)(),{dashboardState:t,layout:a}=this.props,s={is_soft_navigation:O.Yd.timeOriginOffset>0,is_edit_mode:t.editMode,mount_duration:O.Yd.getTimestamp(),is_empty:L(a),is_published:t.isPublished,bootstrap_data_length:e.length},r=(0,k.Z)();r&&(s.target_id=r),this.props.actions.logEvent(O.Wl,s),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:O.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=q(this.props.layout),a=q(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<a.length?a.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(a=e.layout,s=t,Object.values(a).find((e=>e&&e.type===F.dW&&e.meta&&e.meta.chartId===s))));var a,s})):t.length>a.length&&t.filter((e=>-1===a.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:a,appliedOwnDataCharts:s}=this,{activeFilters:r,ownDataCharts:n,chartConfiguration:o}=this.props;(0,i.cr)(i.TT.DASHBOARD_CROSS_FILTERS)&&!o||(t||(0,Z.JB)(s,n,{ignoreUndefined:!0})&&(0,Z.JB)(a,r,{ignoreUndefined:!0})||this.applyFilters(),e?A.onBeforeUnload(!0):A.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:O.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(O.Ev,{...this.visibilityEventData,duration:O.Yd.getTimestamp()-e})}}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:a}=this.props,s=Object.keys(t),r=Object.keys(e),n=new Set(s.concat(r)),o=((e,t)=>{const a=Object.keys(e),s=Object.keys(t),r=(n=a,o=s,[...n.filter((e=>!C()(o).call(o,e))),...o.filter((e=>!C()(n).call(n,e)))]).filter((a=>e[a]||t[a]));var n,o;return new Set([...a,...s]).forEach((a=>{(0,Z.JB)(e[a],t[a])||r.push(a)})),[...new Set(r)]})(a,this.appliedOwnDataCharts);[...n].forEach((a=>{if(!C()(s).call(s,a)&&C()(r).call(r,a))o.push(...e[a].scope);else if(C()(r).call(r,a)){if((0,Z.JB)(e[a].values,t[a].values,{ignoreUndefined:!0})||o.push(...t[a].scope),!(0,Z.JB)(e[a].scope,t[a].scope)){const s=(t[a].scope||[]).concat(e[a].scope||[]);o.push(...s)}}else o.push(...t[a].scope)})),this.refreshCharts([...new Set(o)]),this.appliedFilters=t,this.appliedOwnDataCharts=a}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,r.tZ)(h.Z,null):this.props.children}}A.contextType=$.Zn,A.propTypes=Q,A.defaultProps={initMessages:[],timeout:60,userId:""};const B=A;var P=a(52256),J=a(97381),z=a(43399),N=a(87915),V=a(74599);const Y=(0,u.$j)((function(e){var t,a,s,r,n;const{datasources:o,sliceEntities:i,dataMask:d,dashboardInfo:l,dashboardState:c,dashboardLayout:u,impressionId:p,nativeFilters:h}=e;return{initMessages:null==(t=l.common)?void 0:t.flash_messages,timeout:null==(a=l.common)||null==(s=a.conf)?void 0:s.SUPERSET_WEBSERVER_TIMEOUT,userId:l.userId,dashboardInfo:l,dashboardState:c,datasources:o,activeFilters:{...(0,z.De)(),...(0,N.g)({chartConfiguration:null==(r=l.metadata)?void 0:r.chart_configuration,nativeFilters:h.filters,dataMask:d,allSliceIds:c.sliceIds})},chartConfiguration:null==(n=l.metadata)?void 0:n.chart_configuration,ownDataCharts:(0,N.U)(d,"ownState"),slices:i.slices,layout:u.present,impressionId:p}}),(function(e){return{actions:(0,x.DE)({setDatasources:b.Fy,clearDataMaskState:V.sh,addSliceToDashboard:I.Pi,removeSliceFromDashboard:I.rL,triggerQuery:P.triggerQuery,logEvent:J.logEvent},e)}}))(B);var K=a(14670),W=a.n(K);const X=e=>r.iv`
  body {
    h1 {
      font-weight: ${e.typography.weights.bold};
      line-height: 1.4;
      font-size: ${e.typography.sizes.xxl}px;
      letter-spacing: -0.2px;
      margin-top: ${3*e.gridUnit}px;
      margin-bottom: ${3*e.gridUnit}px;
    }

    h2 {
      font-weight: ${e.typography.weights.bold};
      line-height: 1.4;
      font-size: ${e.typography.sizes.xl}px;
      margin-top: ${3*e.gridUnit}px;
      margin-bottom: ${2*e.gridUnit}px;
    }

    h3,
    h4,
    h5,
    h6 {
      font-weight: ${e.typography.weights.bold};
      line-height: 1.4;
      font-size: ${e.typography.sizes.l}px;
      letter-spacing: 0.2px;
      margin-top: ${2*e.gridUnit}px;
      margin-bottom: ${e.gridUnit}px;
    }
  }
`,H=e=>r.iv`
  .filter-card-popover {
    width: 240px;
    padding: 0;
    border-radius: 4px;

    &.ant-popover-placement-bottom {
      padding-top: ${e.gridUnit}px;
    }

    &.ant-popover-placement-left {
      padding-right: ${3*e.gridUnit}px;
    }

    .ant-popover-inner {
      box-shadow: 0 0 8px rgb(0 0 0 / 10%);
    }

    .ant-popover-inner-content {
      padding: ${4*e.gridUnit}px;
    }

    .ant-popover-arrow {
      display: none;
    }
  }

  .filter-card-tooltip {
    &.ant-tooltip-placement-bottom {
      padding-top: 0;
      & .ant-tooltip-arrow {
        top: -13px;
      }
    }
  }
`,G=e=>r.iv`
  .ant-dropdown-menu.chart-context-menu {
    min-width: ${43*e.gridUnit}px;
  }
  .ant-dropdown-menu-submenu.chart-context-submenu {
    max-width: ${60*e.gridUnit}px;
    min-width: ${40*e.gridUnit}px;
  }
`;var ee=a(78718),te=a.n(ee);const ae={},se=()=>{const e=(0,y.rV)(y.dR.dashboard__explore_context,{});return Object.fromEntries(Object.entries(e).filter((e=>{let[,t]=e;return!t.isRedundant})))},re=(e,t)=>{const a=se();(0,y.LS)(y.dR.dashboard__explore_context,{...a,[e]:t})},ne=e=>{let{dashboardPageId:t}=e;const a=(0,u.v9)((e=>{var a,s,r;let{dashboardInfo:n,dashboardState:o,nativeFilters:i,dataMask:d}=e;return{labelColors:(null==(a=n.metadata)?void 0:a.label_colors)||ae,sharedLabelColors:(null==(s=n.metadata)?void 0:s.shared_label_colors)||ae,colorScheme:null==o?void 0:o.colorScheme,chartConfiguration:(null==(r=n.metadata)?void 0:r.chart_configuration)||ae,nativeFilters:Object.entries(i.filters).reduce(((e,t)=>{let[a,s]=t;return{...e,[a]:te()(s,["chartsInScope"])}}),{}),dataMask:d,dashboardId:n.id,filterBoxFilters:(0,z.De)(),dashboardPageId:t}}),u.wU);return(0,s.useEffect)((()=>(re(t,a),()=>{re(t,{...a,isRedundant:!0})})),[a,t]),null},oe=s.createContext("");(0,v.Z)();const ie=s.lazy((()=>Promise.all([a.e(1216),a.e(527),a.e(876),a.e(981),a.e(5207),a.e(5640),a.e(3197),a.e(95),a.e(868),a.e(9540),a.e(4717),a.e(452)]).then(a.bind(a,83740)))),de=document.title,le=e=>{let{idOrSlug:t}=e;const a=(0,o.Fg)(),v=(0,u.I0)(),x=(0,n.k6)(),R=(0,s.useMemo)((()=>W().generate()),[]),C=(0,u.v9)((e=>{let{dashboardInfo:t}=e;return t&&Object.keys(t).length>0})),{addDangerToast:D}=(0,p.e1)(),{result:T,error:$}=(0,f.QU)(t),{result:j,error:F}=(0,f.Es)(t),{result:q,error:U,status:O}=(0,f.JL)(t),Z=(0,s.useRef)(!1),k=$||F,M=Boolean(T&&j),{dashboard_title:L,css:Q,metadata:A,id:B=0}=T||{},P=(0,i.cr)(i.TT.DASHBOARD_NATIVE_FILTERS_SET)&&(0,i.cr)(i.TT.DASHBOARD_NATIVE_FILTERS);if((0,s.useEffect)((()=>{const e=()=>{const e=se();(0,y.LS)(y.dR.dashboard__explore_context,{...e,[R]:{...e[R],isRedundant:!0}})};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[R]),(0,s.useEffect)((()=>{v((0,I.sL)(O))}),[v,O]),(0,s.useEffect)((()=>{B&&async function(){const e=(0,E.eY)(S.KD.permalinkKey),t=(0,E.eY)(S.KD.nativeFiltersKey),a=(0,E.eY)(S.KD.nativeFilters);let s,r=t||{};if(e){const t=await(0,w.mf)(e);t&&({dataMask:r,activeTabs:s}=t.state)}else t&&(r=await(0,w.B8)(B,t));a&&(r=a),M&&(Z.current||(Z.current=!0,P&&v((0,_.pi)(B))),v((0,m.Y)({history:x,dashboard:T,charts:j,activeTabs:s,dataMask:r})))}()}),[M]),(0,s.useEffect)((()=>(L&&(document.title=L),()=>{document.title=de})),[L]),(0,s.useEffect)((()=>"string"==typeof Q?(0,g.Z)(Q):()=>{}),[Q]),(0,s.useEffect)((()=>{const e=(0,d.ZP)();return e.source=d.Ag.dashboard,()=>{l.getNamespace(null==A?void 0:A.color_namespace).resetColors(),e.clear()}}),[null==A?void 0:A.color_namespace]),(0,s.useEffect)((()=>{U?D((0,c.t)("Error loading chart datasources. Filters may not work correctly.")):v((0,b.Fy)(q))}),[D,q,U,v]),k)throw k;return M&&C?(0,r.tZ)(s.Fragment,null,(0,r.tZ)(r.xB,{styles:[H(a),X(a),G(a),"",""]}),(0,r.tZ)(ne,{dashboardPageId:R}),(0,r.tZ)(oe.Provider,{value:R},(0,r.tZ)(Y,null,(0,r.tZ)(ie,null)))):(0,r.tZ)(h.Z,null)},ce=le},87915:(e,t,a)=>{a.d(t,{U:()=>s,g:()=>r});const s=(e,t)=>Object.values(e).filter((e=>e[t])).reduce(((e,a)=>({...e,[a.id]:t?a[t]:a})),{}),r=e=>{let{chartConfiguration:t,nativeFilters:a,dataMask:s,allSliceIds:r}=e;const n={};return Object.values(s).forEach((e=>{var s,o,i,d,l,c;let{id:u,extraFormData:p}=e;const h=null!=(s=null!=(o=null!=(i=null==a||null==(d=a[u])?void 0:d.chartsInScope)?i:null==t||null==(l=t[u])||null==(c=l.crossFilters)?void 0:c.chartsInScope)?o:r)?s:[];n[u]={scope:h,values:p}})),n}},14505:(e,t,a)=>{function s(e){const t="CssEditor-css",a=document.head||document.getElementsByTagName("head")[0],s=document.querySelector(`.${t}`)||function(e){const t=document.createElement("style");return t.className="CssEditor-css",t.type="text/css",t}();return"styleSheet"in s?s.styleSheet.cssText=e:s.innerHTML=e,a.appendChild(s),function(){s.remove()}}a.d(t,{Z:()=>s})},67417:(e,t,a)=>{a.d(t,{Kt:()=>h.Kt,CN:()=>s.CN,QD:()=>p.QD,hb:()=>d,QU:()=>l,Es:()=>c,JL:()=>u,L8:()=>m,Xx:()=>h.Xx,SJ:()=>p.SJ,uY:()=>p.uY,zA:()=>p.zA});var s=a(45673),r=a(42190),n=a(15926);function o(e){let{owners:t}=e;return t?t.map((e=>`${e.first_name} ${e.last_name}`)):null}const i=a.n(n)().encode({columns:["owners.first_name","owners.last_name"],keys:["none"]});function d(e){return(0,r.l6)((0,r.s_)(`/api/v1/chart/${e}?q=${i}`),o)}const l=e=>(0,r.l6)((0,r.s_)(`/api/v1/dashboard/${e}`),(e=>({...e,metadata:e.json_metadata&&JSON.parse(e.json_metadata)||{},position_data:e.position_json&&JSON.parse(e.position_json),owners:e.owners||[]}))),c=e=>(0,r.s_)(`/api/v1/dashboard/${e}/charts`),u=e=>(0,r.s_)(`/api/v1/dashboard/${e}/datasets`);var p=a(23936),h=a(69279);const f=a(10362).h.injectEndpoints({endpoints:e=>({queryValidations:e.query({providesTags:["QueryValidations"],query:e=>{let{dbId:t,schema:a,sql:s,templateParams:r}=e,n=r;try{n=JSON.parse(r||"")}catch(e){n=void 0}const o={schema:a,sql:s,...n&&{template_params:n}};return{method:"post",endpoint:`/api/v1/database/${t}/validate_sql/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(o),transformResponse:e=>{let{json:t}=e;return t.result}}}})})}),{useQueryValidationsQuery:m}=f},69279:(e,t,a)=>{a.d(t,{Kt:()=>d,Xx:()=>u});var s=a(67294),r=a(38325);const n=a(10362).h.injectEndpoints({endpoints:e=>({schemas:e.query({providesTags:[{type:"Schemas",id:"LIST"}],query:e=>{let{dbId:t,forceRefresh:a}=e;return{endpoint:`/api/v1/database/${t}/schemas/`,urlParams:{force:a},transformResponse:e=>{let{json:t}=e;return t.result.map((e=>({value:e,label:e,title:e})))}}},serializeQueryArgs:e=>{let{queryArgs:{dbId:t}}=e;return{dbId:t}}})})}),{useLazySchemasQuery:o,useSchemasQuery:i,endpoints:d,util:l}=n,c=[];function u(e){const t=(0,s.useRef)(!1),{dbId:a,onSuccess:n,onError:d}=e||{},[l]=o(),u=i({dbId:a,forceRefresh:!1},{skip:!a}),p=(0,r.Z)(((e,t)=>{null==n||n(e,t)})),h=(0,r.Z)((()=>{null==d||d()})),f=(0,s.useCallback)((()=>{a&&l({dbId:a,forceRefresh:!0}).then((e=>{let{isSuccess:t,isError:a,data:s}=e;t&&p(s||c,!0),a&&h()}))}),[a,h,p,l]);return(0,s.useEffect)((()=>{if(t.current){const{requestId:e,isSuccess:t,isError:a,isFetching:s,data:r,originalArgs:n}=u;null!=n&&n.forceRefresh||!e||s||(t&&p(r||c,!1),a&&h())}else t.current=!0}),[u,p,h]),{...u,refetch:f}}},23936:(e,t,a)=>{a.d(t,{$K:()=>h,QD:()=>p,SJ:()=>u,uY:()=>c,zA:()=>f});var s=a(67294),r=a(38325),n=a(10362),o=a(69279);const i=n.h.injectEndpoints({endpoints:e=>({tables:e.query({providesTags:["Tables"],query:e=>{let{dbId:t,schema:a,forceRefresh:s}=e;return{endpoint:`/api/v1/database/${null!=t?t:"undefined"}/tables/`,urlParams:{force:s,schema_name:a?encodeURIComponent(a):""},transformResponse:e=>{let{json:t}=e;return{options:t.result,hasMore:t.count>t.result.length}}}},serializeQueryArgs:e=>{let{queryArgs:{dbId:t,schema:a}}=e;return{dbId:t,schema:a}}}),tableMetadata:e.query({query:e=>{let{dbId:t,schema:a,table:s}=e;return{endpoint:`/api/v1/database/${t}/table/${encodeURIComponent(s)}/${encodeURIComponent(a)}/`,transformResponse:e=>{let{json:t}=e;return t}}}}),tableExtendedMetadata:e.query({query:e=>{let{dbId:t,schema:a,table:s}=e;return{endpoint:`/api/v1/database/${t}/table_extra/${encodeURIComponent(s)}/${encodeURIComponent(a)}/`,transformResponse:e=>{let{json:t}=e;return t}}}})})}),{useLazyTablesQuery:d,useTablesQuery:l,useTableMetadataQuery:c,useTableExtendedMetadataQuery:u,endpoints:p,util:h}=i;function f(e){const t=(0,s.useRef)(!1),{data:a,isFetching:n}=(0,o.Xx)({dbId:e.dbId}),i=(0,s.useMemo)((()=>new Set(null==a?void 0:a.map((e=>{let{value:t}=e;return t})))),[a]),{dbId:c,schema:u,onSuccess:p,onError:h}=e||{},f=Boolean(c&&u&&!n&&i.has(u)),m=l({dbId:c,schema:u,forceRefresh:!1},{skip:!f}),[b]=d(),g=(0,r.Z)(((e,t)=>{null==p||p(e,t)})),v=(0,r.Z)((e=>{null==h||h(e)})),y=(0,s.useCallback)((()=>{f&&b({dbId:c,schema:u,forceRefresh:!0}).then((e=>{let{isSuccess:t,isError:a,data:s,error:r}=e;t&&s&&g(s,!0),a&&v(r)}))}),[c,u,f,g,v,b]);return(0,s.useEffect)((()=>{if(t.current){const{requestId:e,isSuccess:t,isError:a,isFetching:s,data:r,error:n,originalArgs:o}=m;null!=o&&o.forceRefresh||!e||s||(t&&r&&g(r,!1),a&&v(n))}else t.current=!0}),[m,g,v]),{...m,refetch:y}}}}]);
//# sourceMappingURL=9aece0b1898c217b7611.chunk.js.map