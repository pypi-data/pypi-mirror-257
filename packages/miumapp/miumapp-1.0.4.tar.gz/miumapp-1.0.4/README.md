# é¡¹ç›®æè¿°

ä¸€ä¸ªä½¿ç”¨ Python + HTML + CSS + JavaScript å¼€å‘æ¡Œé¢åº”ç”¨çš„æ¡†æ¶ã€‚

åŠŸèƒ½ï¼š

* å¯åœ¨ HTML ä¸­è°ƒç”¨åç«¯çš„ Python å‡½æ•°ã€‚
* å¯åœ¨ Python ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çª—å£å†…çš„ JavaScript å¯¹è±¡ã€‚
* å¯åœ¨ Python ä¸Šä¸‹æ–‡ä¸­å¯¹çª—å£å‘é€æ“çºµæŒ‡ä»¤ï¼Œæ‰§è¡ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šURLè·³è½¬ã€å…³é—­çª—å£ã€JSæ³¨å…¥ã€æœ€å¤§åŒ–ç­‰æ“ä½œã€‚
* å¯å¼€å¯å¤šä¸ªçª—å£ã€‚
* ç”±äºæ¯ä¸ªçª—å£å¯ä¸ Python åŒå‘è°ƒç”¨ï¼Œå› æ­¤ä¸åŒçª—å£ä¹‹é—´å¯é€šè¿‡ã€çª—å£A â†’ Python â†’ çª—å£Bã€‘çš„é€”å¾„ç›¸äº’è°ƒç”¨ã€‚
* å¯æŒ‡å®šçª—å£æ ‡é¢˜ã€‚
* å¯æŒ‡å®šçª—å£å›¾æ ‡ã€‚
* å¯é€šè¿‡ä¼ é€’ URL æˆ– HTML æ–‡æœ¬è¿™ä¸¤ç§æ•°æ®ä¹‹ä¸€æ¥å†³å®šçª—å£å†…å®¹ã€‚
* å¯é€šè¿‡ Nuitka æ‰“åŒ…æˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚

æˆ‘ä»¬æ‰€é‡‡ç”¨çš„æŠ€æœ¯æ ˆç»„åˆæ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ï¼Œé€šè¿‡ç»“åˆ **Python** çš„é«˜æ•ˆæ€§å’Œæ˜“ç”¨æ€§ï¼Œä»¥åŠ  **HTML** ã€**CSS** å’Œ **JavaScript** çš„å‰ç«¯æŠ€æœ¯ï¼Œæ„å‘³ç€æ‚¨æ­£åœ¨é€‰æ‹©ä¸€ä¸ªèƒ½å¤Ÿå¤§å¤§å‡å°‘å¼€å‘æ—¶é—´ã€ç®€åŒ–å¼€å‘æµç¨‹ã€æ‹¥æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹æ‰©å±•çš„è§£å†³æ–¹æ¡ˆã€‚ä¸å…¶å®ƒå·¥å…·ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„ä¼˜åŠ¿åœ¨äºå¯¹æ–°æŠ€æœ¯çš„å¿«é€Ÿé€‚åº”ã€æ›´ä¸ºå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä»¥åŠæŒç»­çš„æ›´æ–°å’Œæ”¹è¿›ã€‚

# ä½œè€…ä¿¡æ¯

æ˜µç§°ï¼šæ±Ÿå—é›¨ä¸Š

[ä¸»é¡µ](https://lcctoor.github.io/arts/) \| [å¾®ä¿¡](https://lcctoor.github.io/arts/arts/ip_static/WeChatQRC.jpg) \| [Github](https://github.com/lcctoor) \| [PyPi](https://pypi.org/user/lcctoor) \| [é‚®ç®±](mailto:lcctoor@outlook.com) \| [æèµ ](https://lcctoor.github.io/arts/arts/ip_static/DonationQRC-0rmb.jpg)

# Bugæäº¤ã€åŠŸèƒ½æè®®

æ‚¨å¯ä»¥é€šè¿‡ [Github-Issues](https://github.com/lcctoor/arts/issues)ã€[å¾®ä¿¡](https://lcctoor.github.io/arts/arts/ip_static/WeChatQRC.jpg) ä¸æˆ‘è”ç³»ã€‚

# å®‰è£…

```
pip install miumapp
```

# æ•™ç¨‹ ([æŸ¥çœ‹ç¾åŒ–ç‰ˆ](https://lcctoor.github.io/arts/arts/miumapp) ğŸ‘ˆ)

æœ¬æ–‡å°†ä»¥æœ€ç®€æ´çš„æ–¹å¼å‘ä½ ä»‹ç»æ ¸å¿ƒçŸ¥è¯†ï¼Œè€Œä¸ä¼šè®©ä½ è¢«ç¹ççš„æœ¯è¯­æ‰€æ·¹æ²¡ã€‚

## è¿è¡Œå†…ç½®Demo

```python
import asyncio
from pathlib import Path
from miumapp.demo import demo_app


# æŒ‡å®šchromiumæµè§ˆå™¨è·¯å¾„
# chromiumå®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttps://www.chromium.org/getting-involved/download-chromium/
# åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Windowsè‡ªå¸¦çš„Edgeæµè§ˆå™¨ï¼Œç”±äºEdgeæµè§ˆå™¨æ˜¯åŸºäºchromiumå†…æ ¸å¼€å‘çš„ï¼Œå› æ­¤ä½¿ç”¨Edgeæµè§ˆå™¨ä¹Ÿèƒ½è¾¾åˆ°å‡ ä¹ç›¸åŒçš„æ•ˆæœ
chrome = r'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'

# æŒ‡å®šchromiumç¼“å­˜è·¯å¾„
cache_dir = Path('~/.miumapp/demo').expanduser()

# è¿è¡Œdemo
task = demo_app(chrome=chrome, chrome_cache_dir=cache_dir)
asyncio.run(task)
```

[demoæ•ˆæœå›¾](https://lcctoor.github.io/arts/arts/miumapp/ip_static/DemoUI.png) ğŸ‘ˆ

## å¯¼å…¥

```python
import asyncio
from pathlib import Path
from miumapp import App, allow_callpy
```

## åˆ›å»º APP

```python
class my_app(App):
  
    async def main(self):
        ...

# æŒ‡å®šchromiumæµè§ˆå™¨è·¯å¾„
# chromiumå®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttps://www.chromium.org/getting-involved/download-chromium/
# åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Windowsè‡ªå¸¦çš„Edgeæµè§ˆå™¨ï¼Œç”±äºEdgeæµè§ˆå™¨æ˜¯åŸºäºchromiumå†…æ ¸å¼€å‘çš„ï¼Œå› æ­¤ä½¿ç”¨Edgeæµè§ˆå™¨ä¹Ÿèƒ½è¾¾åˆ°å‡ ä¹ç›¸åŒçš„æ•ˆæœ
chrome = r'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'

# è¿è¡ŒAPP
task = my_app(chrome=chrome).start()
asyncio.run(task)
```

ç”±äºæˆ‘ä»¬åœ¨ä¸»ä»»åŠ¡ main ä¸­æœªå®šä¹‰ä»»ä½•ä»£ç ï¼Œå› æ­¤è¿™ä¸ª APP æ˜¯ä¸€ä¸ªç©º APPï¼Œè¿è¡Œåçœ‹ä¸åˆ°ä»»ä½•æ•ˆæœã€‚

## åˆ›å»ºçª—å£

åˆ›å»ºä¸€ä¸ªçª—å£æ—¶ï¼Œå¿…é¡»æŒ‡å®šã€çª—å£å†…å®¹æºã€‘å’Œã€çª—å£ç¼“å­˜æ–‡ä»¶å¤¹ã€‘ã€‚

```python
class my_app(App):
  
    async def main(self):
        html = 'Hello, miumapp !'
        cache_dir = Path('~/.miumapp/cache_dir/1').expanduser()  # ç›¸å½“äº 'C:/Users/<å½“å‰ç”¨æˆ·å>/.miumapp/cache_dir/1'
        await self.create_window(html=html, cache_dir=cache_dir)

chrome = r'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'
task = my_app(chrome=chrome).start()
asyncio.run(task)
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†èƒ½çœ‹åˆ°å±å¹•ä¸Šæ‰“å¼€äº†ä¸€ä¸ªçª—å£ï¼Œå…¶å†…å®¹ä¸ºâ€œHello, miumapp !â€ã€‚

### æŒ‡å®šçª—å£å†…å®¹æº

å¯é€šè¿‡ä¼ é€’ URL æˆ– HTML æ–‡æœ¬è¿™ä¸¤ç§æ•°æ®ä¹‹ä¸€æ¥å†³å®šçª—å£å†…å®¹ï¼Œä¾‹å¦‚ï¼š

```python
await self.create_window(html='ä½ å¥½!', cache_dir=cache_dir)
```

```python
await self.create_window(url='https://www.baidu.com/', cache_dir=cache_dir)
```

### æŒ‡å®šçª—å£æ ‡é¢˜

```python
await self.create_window(html='ä½ å¥½!', cache_dir=cache_dir, title='ç¬¬ä¸€ä¸ªçª—å£')
```

### çª—å£ç¼“å­˜æ–‡ä»¶å¤¹

ä¸åŒçš„çª—å£å®ä¾‹ä¸èƒ½åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªç¼“å­˜æ–‡ä»¶å¤¹ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¯é”™è¯¯çš„ï¼š

```python
window1 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/1')
window2 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/1')
```

ä»¥ä¸‹ç¤ºä¾‹æ˜¯å¯è¡Œçš„ï¼š

```python
window1 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/1')
window2 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/2')
```

ä»¥ä¸‹ç¤ºä¾‹ä¹Ÿæ˜¯å¯è¡Œçš„ï¼š

```python
window1 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/1')
await window1.close()  # å…³é—­ç¬¬ä¸€ä¸ªçª—å£
window2 = await self.create_window(html='ä½ å¥½!', cache_dir='C:/miumapp_cache_dir/1')
```

## å…³é—­çª—å£

å¯é€šè¿‡å¯¹çª—å£å¯¹è±¡æ‰§è¡Œ `await window.close()` æˆ–è€…ç‚¹å‡»çª—å£å³ä¸Šè§’çš„ `Ã—` å›¾æ ‡æ¥å…³é—­çª—å£ã€‚

## åœ¨ HTML ä¸­è°ƒç”¨ Python å‡½æ•°

ä½¿ç”¨ allow_callpy è£…é¥°çš„ Python å¼‚æ­¥å‡½æ•°å°†èƒ½å¤Ÿåœ¨ HTML ä¸­è¢«è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š

```python
class my_app(App):
  
    async def main(self):
        html = 'Hello, miumapp !'
        cache_dir = Path('~/.miumapp/cache_dir/1').expanduser()
        await self.create_window(html=html, cache_dir=cache_dir)

    @allow_callpy
    async def addition(self, a, b):
        return a + b

    async def sub(self, a, b):
        return a - b

chrome = r'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'
task = my_app(chrome=chrome).start()
asyncio.run(task)
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³• sub åªèƒ½åœ¨ Python å±‚é¢è¢«è°ƒç”¨ï¼Œè€Œæ–¹æ³• addition æ—¢èƒ½åœ¨ Python å±‚é¢è¢«è°ƒç”¨ï¼Œä¹Ÿèƒ½åœ¨ HTML ä¸­è¢«è°ƒç”¨ã€‚

åœ¨ HTML ä¸­è°ƒç”¨ addition æ–¹æ³•ï¼š

```JavaScript
async function sum() {
    let a = parseInt( document.getElementById('a').value )  // 30
    let b = parseInt( document.getElementById('b').value )  // 50
    let kwargs = {a:a, b:b}
    let result = await miumapp.callpy(method='addition', kwargs=kwargs)
    console.log(result)  // {"code":0, "msg":"", "data":80}
}
```

## åœ¨ Python ä¸­è°ƒç”¨ JavaScript å¯¹è±¡

### ä¸€äº›ç¤ºä¾‹

æ‰§è¡Œ JavaScript ä»£ç ï¼š

```python
await window.evaluate("document.title = 'ç¬¬ä¸€ä¸ªAPP'", force_expr=True)
```

```python
await window.evaluate("alert(1)", force_expr=True)
```

è·å–å˜é‡å€¼ï¼š

```python
CityName = await window.evaluate("CityName")  # å‡è®¾çª—å£ä¸­æœ‰ä¸€ä¸ªå« CityName çš„å˜é‡
print(CityName)  # >>> 'åŒ—äº¬å¸‚'
```

è°ƒç”¨å‡½æ•°å¹¶è·å–è¿”å›å€¼ï¼š

```python
city_name = await window.evaluate("get_city_name()", force_expr=True)  # å‡è®¾çª—å£ä¸­æœ‰ä¸€ä¸ªå« get_city_name çš„å‡½æ•°
print(city_name)  # >>> 'ä¸Šæµ·å¸‚'
```

ç”±äº window å¯¹è±¡ç»§æ‰¿è‡ª pyppeteer.page.Pageï¼Œå› æ­¤ window.evaluate æ”¯æŒ pyppeteer.page.Page.evaluate çš„æ‰€æœ‰ç”¨æ³•ã€‚å…³äº window.evaluate çš„æ›´å¤šç”¨æ³•ï¼Œè¯·å‚è€ƒ [pyppeteer.page.Page.evaluate](https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page.evaluate) ã€‚

## window å¯¹è±¡çš„æ›´å¤šæ–¹æ³•

ç”±äº window å¯¹è±¡ç»§æ‰¿è‡ª pyppeteer.page.Pageï¼Œå› æ­¤ window æ”¯æŒ pyppeteer.page.Page çš„æ‰€æœ‰æ–¹æ³•ï¼Œä¾‹å¦‚é¡µé¢è·³è½¬ã€ç‚¹å‡»æŒ‰é’®ã€è¾“å…¥ç­‰ã€‚å…³äº window çš„æ›´å¤šæ–¹æ³•ï¼Œè¯·å‚è€ƒ [pyppeteer.page.Page](https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page) ã€‚
