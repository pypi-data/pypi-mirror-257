
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>futurize: Py2 to Py2/3 &#8212; Python-Future  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/jinja.css?v=85659ec6" />
    <link rel="stylesheet" href="_static/my-styles.css" type="text/css" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="_static/python-future-icon-32.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19344199-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Python-Future  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="docutils literal notranslate"><span class="pre">futurize</span></code>: Py2 to Py2/3</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="futurize-py2-to-py2-3">
<span id="forwards-conversion"></span><h1><code class="docutils literal notranslate"><span class="pre">futurize</span></code>: Py2 to Py2/3<a class="headerlink" href="#futurize-py2-to-py2-3" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">futurize</span></code> script passes Python 2 code through all the appropriate fixers
to turn it into valid Python 3 code, and then adds <code class="docutils literal notranslate"><span class="pre">__future__</span></code> and
<code class="docutils literal notranslate"><span class="pre">future</span></code> package imports to re-enable compatibility with Python 2.</p>
<p>For example, running <code class="docutils literal notranslate"><span class="pre">futurize</span></code> turns this Python 2 code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ConfigParser</span>                 <span class="c1"># Py2 module name</span>

<span class="k">class</span> <span class="nc">Upper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                 <span class="c1"># Py2-style iterator interface</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="n">itr</span> <span class="o">=</span> <span class="n">Upper</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="nb">next</span><span class="p">(</span><span class="n">itr</span><span class="p">),</span>
<span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">itr</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">letter</span><span class="p">,</span>                   <span class="c1"># Py2-style print statement</span>
</pre></div>
</div>
<p>into this code which runs on both Py2 and Py3:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">future</span> <span class="kn">import</span> <span class="n">standard_library</span>
<span class="n">standard_library</span><span class="o">.</span><span class="n">install_aliases</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="kn">import</span> <span class="nb">next</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="kn">import</span> <span class="nb">object</span>
<span class="kn">import</span> <span class="nn">configparser</span>                 <span class="c1"># Py3-style import</span>

<span class="k">class</span> <span class="nc">Upper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>             <span class="c1"># Py3-style iterator interface</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="n">itr</span> <span class="o">=</span> <span class="n">Upper</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">itr</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>           <span class="c1"># Py3-style print function</span>
<span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">itr</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To write out all the changes to your Python files that <code class="docutils literal notranslate"><span class="pre">futurize</span></code> suggests,
use the <code class="docutils literal notranslate"><span class="pre">-w</span></code> flag.</p>
<p>For complex projects, it is probably best to divide the porting into two stages.
Stage 1 is for “safe” changes that modernize the code but do not break Python
2.7 compatibility or introduce a dependency on the <code class="docutils literal notranslate"><span class="pre">future</span></code> package. Stage 2
is to complete the process.</p>
<section id="stage-1-safe-fixes">
<span id="forwards-conversion-stage1"></span><h2>Stage 1: “safe” fixes<a class="headerlink" href="#stage-1-safe-fixes" title="Link to this heading">¶</a></h2>
<p>Run the first stage of the conversion process with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">futurize</span> <span class="o">--</span><span class="n">stage1</span> <span class="n">mypackage</span><span class="o">/*.</span><span class="n">py</span>
</pre></div>
</div>
<p>or, if you are using zsh, recursively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">futurize</span> <span class="o">--</span><span class="n">stage1</span> <span class="n">mypackage</span><span class="o">/**/*.</span><span class="n">py</span>
</pre></div>
</div>
<p>This applies fixes that modernize Python 2 code without changing the effect of
the code. With luck, this will not introduce any bugs into the code, or will at
least be trivial to fix. The changes are those that bring the Python code
up-to-date without breaking Py2 compatibility. The resulting code will be
modern Python 2.7-compatible code plus <code class="docutils literal notranslate"><span class="pre">__future__</span></code> imports from the
following set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</pre></div>
</div>
<p>Only those <code class="docutils literal notranslate"><span class="pre">__future__</span></code> imports deemed necessary will be added unless
the <code class="docutils literal notranslate"><span class="pre">--all-imports</span></code> command-line option is passed to <code class="docutils literal notranslate"><span class="pre">futurize</span></code>, in
which case they are all added.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code> declaration is not added
unless the <code class="docutils literal notranslate"><span class="pre">--unicode-literals</span></code> flag is passed to <code class="docutils literal notranslate"><span class="pre">futurize</span></code>.</p>
<p>The changes include:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="k">except</span> <span class="n">MyException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
<span class="o">+</span> <span class="k">except</span> <span class="n">MyException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="o">-</span> <span class="nb">print</span> <span class="o">&gt;&gt;</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;Blah&quot;</span>
<span class="o">+</span> <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="o">+</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Blah&quot;</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

<span class="o">-</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
<span class="o">+</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<span class="o">-</span> <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="o">+</span> <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="o">-</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<span class="o">+</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
</pre></div>
</div>
<p>Implicit relative imports fixed, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="kn">import</span> <span class="nn">mymodule</span>
<span class="o">+</span> <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="o">+</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mymodule</span>
</pre></div>
</div>
<p>Stage 1 does not add any imports from the <code class="docutils literal notranslate"><span class="pre">future</span></code> package. The output of
stage 1 will probably not (yet) run on Python 3.</p>
<p>The goal for this stage is to create most of the <code class="docutils literal notranslate"><span class="pre">diff</span></code> for the entire
porting process, but without introducing any bugs. It should be uncontroversial
and safe to apply to every Python 2 package. The subsequent patches introducing
Python 3 compatibility should then be shorter and easier to review.</p>
<p>The complete set of fixers applied by <code class="docutils literal notranslate"><span class="pre">futurize</span> <span class="pre">--stage1</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_apply</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_except</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_exec</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_exitfunc</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_funcattrs</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_has_key</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_idioms</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_intern</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_isinstance</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_methodattrs</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_ne</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_numliterals</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_paren</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_reduce</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_renames</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_repr</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_standarderror</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_sys_exc</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_throw</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_tuple_params</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_types</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_ws_comma</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_xreadlines</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_absolute_import</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_next_call</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_print_with_import</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_raise</span>
</pre></div>
</div>
<p>The following fixers from <code class="docutils literal notranslate"><span class="pre">lib2to3</span></code> are not applied:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_import</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fix_absolute_import</span></code> fixer in <code class="docutils literal notranslate"><span class="pre">libfuturize.fixes</span></code> is applied instead of
<code class="docutils literal notranslate"><span class="pre">lib2to3.fixes.fix_import</span></code>. The new fixer both makes implicit relative
imports explicit and adds the declaration <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span>
<span class="pre">absolute_import</span></code> at the top of each relevant module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_next</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fix_next_call</span></code> fixer in <code class="docutils literal notranslate"><span class="pre">libfuturize.fixes</span></code> is applied instead of
<code class="docutils literal notranslate"><span class="pre">fix_next</span></code> in stage 1. The new fixer changes any <code class="docutils literal notranslate"><span class="pre">obj.next()</span></code> calls to
<code class="docutils literal notranslate"><span class="pre">next(obj)</span></code>, which is Py2/3 compatible, but doesn’t change any <code class="docutils literal notranslate"><span class="pre">next</span></code> method
names to <code class="docutils literal notranslate"><span class="pre">__next__</span></code>, which would break Py2 compatibility.</p>
<p><code class="docutils literal notranslate"><span class="pre">fix_next</span></code> is applied in stage 2.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_print</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fix_print_with_import</span></code> fixer in <code class="docutils literal notranslate"><span class="pre">libfuturize.fixes</span></code> changes the code to
use print as a function and also adds <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span>
<span class="pre">print_function</span></code> to the top of modules using <code class="docutils literal notranslate"><span class="pre">print()</span></code>.</p>
<p>In addition, it avoids adding an extra set of parentheses if these already
exist. So <code class="docutils literal notranslate"><span class="pre">print(x)</span></code> does not become <code class="docutils literal notranslate"><span class="pre">print((x))</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_raise</span>
</pre></div>
</div>
<p>This fixer translates code to use the Python 3-only <code class="docutils literal notranslate"><span class="pre">with_traceback()</span></code>
method on exceptions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_set_literal</span>
</pre></div>
</div>
<p>This converts <code class="docutils literal notranslate"><span class="pre">set([1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>) to <code class="docutils literal notranslate"><span class="pre">{1,</span> <span class="pre">2,</span> <span class="pre">3}</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_ws_comma</span>
</pre></div>
</div>
<p>This performs cosmetic changes. This is not applied by default because it
does not serve to improve Python 2/3 compatibility. (In some cases it may
also reduce readability: see issue #58.)</p>
</section>
<section id="stage-2-py3-style-code-with-wrappers-for-py2">
<span id="forwards-conversion-stage2"></span><h2>Stage 2: Py3-style code with wrappers for Py2<a class="headerlink" href="#stage-2-py3-style-code-with-wrappers-for-py2" title="Link to this heading">¶</a></h2>
<p>Run stage 2 of the conversion process with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">futurize</span> <span class="o">--</span><span class="n">stage2</span> <span class="n">myfolder</span><span class="o">/*.</span><span class="n">py</span>
</pre></div>
</div>
<p>This stage adds a dependency on the <code class="docutils literal notranslate"><span class="pre">future</span></code> package. The goal for stage 2 is
to make further mostly safe changes to the Python 2 code to use Python 3-style
code that then still runs on Python 2 with the help of the appropriate builtins
and utilities in <code class="docutils literal notranslate"><span class="pre">future</span></code>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s1">&#39;What is your name?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;My object&#39;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would be converted by Stage 2 to this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">str</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">python_2_unicode_compatible</span>

<span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What is your name?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span>

<span class="nd">@python_2_unicode_compatible</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;My object&#39;</span>
</pre></div>
</div>
<p>Stage 2 also renames standard-library imports to their Py3 names and adds these
two lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future</span> <span class="kn">import</span> <span class="n">standard_library</span>
<span class="n">standard_library</span><span class="o">.</span><span class="n">install_aliases</span><span class="p">()</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ConfigParser</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future</span> <span class="kn">import</span> <span class="n">standard_library</span>
<span class="n">standard_library</span><span class="o">.</span><span class="n">install_aliases</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">configparser</span>
</pre></div>
</div>
<p>The complete list of fixers applied in Stage 2 is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_dict</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_filter</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_getcwdu</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_input</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_itertools</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_itertools_imports</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_long</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_map</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_next</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_nonzero</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_operator</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_raw_input</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_zip</span>

<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_basestring</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_cmp</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_division_safe</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_execfile</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_future_builtins</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_future_standard_library</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_future_standard_library_urllib</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_metaclass</span>
<span class="n">libpasteurize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_newstyle</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_object</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_unicode_keep_u</span>
<span class="n">libfuturize</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_xrange_with_import</span>
</pre></div>
</div>
<p>Not applied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_buffer</span>    <span class="c1"># Perhaps not safe. Test this.</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_callable</span>  <span class="c1"># Not needed in Py3.2+</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_execfile</span>  <span class="c1"># Some problems: see issue #37.</span>
                            <span class="c1"># We use the custom libfuturize.fixes.fix_execfile instead.</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_future</span>    <span class="c1"># Removing __future__ imports is bad for Py2 compatibility!</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_imports</span>   <span class="c1"># Called by libfuturize.fixes.fix_future_standard_library</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_imports2</span>  <span class="c1"># We don&#39;t handle this yet (dbm)</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_metaclass</span> <span class="c1"># Causes SyntaxError in Py2! Use the one from ``six`` instead</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_unicode</span>   <span class="c1"># Strips off the u&#39;&#39; prefix, which removes a potentially</span>
                            <span class="c1"># helpful source of information for disambiguating</span>
                            <span class="c1"># unicode/byte strings.</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_urllib</span>    <span class="c1"># Included in libfuturize.fix_future_standard_library_urllib</span>
<span class="n">lib2to3</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">fix_xrange</span>    <span class="c1"># Custom one because of a bug with Py3.3&#39;s lib2to3</span>
</pre></div>
</div>
</section>
<section id="separating-text-from-bytes">
<span id="forwards-conversion-text"></span><h2>Separating text from bytes<a class="headerlink" href="#separating-text-from-bytes" title="Link to this heading">¶</a></h2>
<p>After applying stage 2, the recommended step is to decide which of your Python
2 strings represent text and which represent binary data and to prefix all
string literals with either <code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">u</span></code> accordingly. Furthermore, to ensure
that these types behave similarly on Python 2 as on Python 3, also wrap
byte-strings or text in the <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">str</span></code> types from <code class="docutils literal notranslate"><span class="pre">future</span></code>. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">ABCD&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;This is normal text&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Any unadorned string literals will then represent native platform strings
(byte-strings on Py2, unicode strings on Py3).</p>
<p>An alternative is to pass the <code class="docutils literal notranslate"><span class="pre">--unicode-literals</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ futurize --unicode-literals mypython2script.py
</pre></div>
</div>
<p>After running this, all string literals that were not explicitly marked up as
<code class="docutils literal notranslate"><span class="pre">b''</span></code> will mean text (Python 3 <code class="docutils literal notranslate"><span class="pre">str</span></code> or Python 2 <code class="docutils literal notranslate"><span class="pre">unicode</span></code>).</p>
</section>
<section id="post-conversion">
<span id="forwards-conversion-stage3"></span><h2>Post-conversion<a class="headerlink" href="#post-conversion" title="Link to this heading">¶</a></h2>
<p>After running <code class="docutils literal notranslate"><span class="pre">futurize</span></code>, we recommend first running your tests on Python 3 and making further code changes until they pass on Python 3.</p>
<p>The next step would be manually tweaking the code to re-enable Python 2
compatibility with the help of the <code class="docutils literal notranslate"><span class="pre">future</span></code> package. For example, you can add
the <code class="docutils literal notranslate"><span class="pre">&#64;python_2_unicode_compatible</span></code> decorator to any classes that define custom
<code class="docutils literal notranslate"><span class="pre">__str__</span></code> methods. See <a class="reference internal" href="what_else.html#what-else"><span class="std std-ref">What else you need to know</span></a> for more info.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/python-future-logo-textless-transparent.png" alt="Logo"/>
            </a></p>
  
<!--<h3>Python-Future</h3>
<p>-->
  <h4>Easy, clean, reliable Python 2/3 compatibility</h4>
  <a href="https://python-future.org/#contents">Table of Contents</a>
<!--
</p>
<h3>Other Formats</h3>
<p>
  You can download the documentation in other formats as well:
</p>
<ul>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.pdf">as PDF</a>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.zip">as zipped HTML</a>
</ul>
-->
<!--<h3>Useful Links</h3>
<ul>
  <li><a href="https://pypi.org/project/future/">on PyPI</a></li>
  <li><a href="https://github.com/PythonCharmers/python-future">on GitHub</a></li>
</ul>
--><ul>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview: Easy, clean, reliable Python 2/3 compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick-start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatible_idioms.html">Cheat Sheet: Writing Python 2-3 compatible code</a></li>
<li class="toctree-l1"><a class="reference internal" href="imports.html">Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_else.html">What else you need to know</a></li>
<li class="toctree-l1"><a class="reference internal" href="automatic_conversion.html">Automatic conversion to Py2/3</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib_incompatibilities.html">Standard library incompatibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="older_interfaces.html">Older interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes in previous versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Licensing and credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference (in progress)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2019, Python Charmers Pty Ltd, Australia.
    </div>
  <script src="_static/version_warning_offset.js"></script>

<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>