
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Should I import unicode_literals? &#8212; Python-Future  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/jinja.css?v=85659ec6" />
    <link rel="stylesheet" href="_static/my-styles.css" type="text/css" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="_static/python-future-icon-32.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19344199-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Python-Future  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Should I import unicode_literals?</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="should-i-import-unicode-literals">
<span id="unicode-literals"></span><h1>Should I import unicode_literals?<a class="headerlink" href="#should-i-import-unicode-literals" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">future</span></code> package can be used with or without <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code>
imports.</p>
<p>In general, it is more compelling to use <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> when
back-porting new or existing Python 3 code to Python 2/3 than when porting
existing Python 2 code to 2/3. In the latter case, explicitly marking up all
unicode string literals with <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes would help to avoid
unintentionally changing the existing Python 2 API. However, if changing the
existing Python 2 API is not a concern, using <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> may speed up
the porting process.</p>
<p>This section summarizes the benefits and drawbacks of using
<code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code>. To avoid confusion, we recommend using
<code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> everywhere across a code-base or not at all, instead of
turning on for only some modules.</p>
<section id="benefits">
<h2>Benefits<a class="headerlink" href="#benefits" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>String literals are unicode on Python 3. Making them unicode on Python 2
leads to more consistency of your string types across the two
runtimes. This can make it easier to understand and debug your code.</p></li>
<li><p>Code without <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes is cleaner, one of the claimed advantages
of Python 3. Even though some unicode strings would require a function
call to invert them to native strings for some Python 2 APIs (see
<a class="reference internal" href="stdlib_incompatibilities.html#stdlib-incompatibilities"><span class="std std-ref">Standard library incompatibilities</span></a>), the incidence of these function calls
would usually be much lower than the incidence of <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes for text
strings in the absence of <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code>.</p></li>
<li><p>The diff when porting to a Python 2/3-compatible codebase may be smaller,
less noisy, and easier to review with <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> than if an
explicit <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefix is added to every unadorned string literal.</p></li>
<li><p>If support for Python 3.2 is required (e.g. for Ubuntu 12.04 LTS or
Debian wheezy), <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes are a <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, making
<code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> the only option for a Python 2/3 compatible
codebase. [However, note that <code class="docutils literal notranslate"><span class="pre">future</span></code> doesn’t support Python 3.0-3.2.]</p></li>
</ol>
</section>
<section id="drawbacks">
<h2>Drawbacks<a class="headerlink" href="#drawbacks" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Adding <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> to a module amounts to a “global flag day” for
that module, changing the data types of all strings in the module at once.
Cautious developers may prefer an incremental approach. (See
<a class="reference external" href="http://lwn.net/Articles/165039/">here</a> for an excellent article
describing the superiority of an incremental patch-set in the the case
of the Linux kernel.)</p></li>
</ol>
<ol class="arabic" start="2">
<li><p>Changing to <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> will likely introduce regressions on
Python 2 that require an initial investment of time to find and fix. The
APIs may be changed in subtle ways that are not immediately obvious.</p>
<p>An example on Python 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### Module: mypaths.py</span>

<span class="o">...</span>
<span class="k">def</span> <span class="nf">unix_style_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="o">...</span>

<span class="c1">### User code:</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">path1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ed&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">unix_style_path</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
<span class="s1">&#39;/Users/ed&#39;</span>
</pre></div>
</div>
<p>On Python 2, adding a <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> import to <code class="docutils literal notranslate"><span class="pre">mypaths.py</span></code> would
change the return type of the <code class="docutils literal notranslate"><span class="pre">unix_style_path</span></code> function from <code class="docutils literal notranslate"><span class="pre">str</span></code> to
<code class="docutils literal notranslate"><span class="pre">unicode</span></code> in the user code, which is difficult to anticipate and probably
unintended.</p>
<p>The counter-argument is that this code is broken, in a portability
sense; we see this from Python 3 raising a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> upon passing the
function a byte-string. The code needs to be changed to make explicit
whether the <code class="docutils literal notranslate"><span class="pre">path</span></code> argument is to be a byte string or a unicode string.</p>
</li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> in effect, there is no way to specify a native
string literal (<code class="docutils literal notranslate"><span class="pre">str</span></code> type on both platforms). This can be worked around as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">bytes_to_native_str</span> <span class="k">as</span> <span class="n">n</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">n</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;ABCD&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">&#39;ABCD&#39;  # on both Py2 and Py3</span>
</pre></div>
</div>
<p>although this incurs a performance penalty (a function call and, on Py3,
a <code class="docutils literal notranslate"><span class="pre">decode</span></code> method call.)</p>
<p>This is a little awkward because various Python library APIs (standard
and non-standard) require a native string to be passed on both Py2
and Py3. (See <a class="reference internal" href="stdlib_incompatibilities.html#stdlib-incompatibilities"><span class="std std-ref">Standard library incompatibilities</span></a> for some examples. WSGI
dictionaries are another.)</p>
</li>
</ol>
<ol class="arabic" start="3">
<li><p>If a codebase already explicitly marks up all text with <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes,
and if support for Python versions 3.0-3.2 can be dropped, then
removing the existing <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes and replacing these with
<code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> imports (the porting approach Django used) would
introduce more noise into the patch and make it more difficult to review.
However, note that the <code class="docutils literal notranslate"><span class="pre">futurize</span></code> script takes advantage of PEP 414 and
does not remove explicit <code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes that already exist.</p></li>
<li><p>Turning on <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> converts even docstrings to unicode, but
Pydoc breaks with unicode docstrings containing non-ASCII characters for
Python versions &lt; 2.7.7. (<a class="reference external" href="http://bugs.python.org/issue1065986#msg207403">Fix
committed</a> in Jan 2014.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s2">&quot;Author: Martin von Löwis&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="go">/Users/schofield/Install/anaconda/python.app/Contents/lib/python2.7/pydoc.pyc in pipepager(text, cmd)</span>
<span class="go">   1376     pipe = os.popen(cmd, &#39;w&#39;)</span>
<span class="go">   1377     try:</span>
<span class="go">-&gt; 1378         pipe.write(text)</span>
<span class="go">   1379         pipe.close()</span>
<span class="go">   1380     except IOError:</span>

<span class="go">UnicodeEncodeError: &#39;ascii&#39; codec can&#39;t encode character u&#39;\xf6&#39; in position 71: ordinal not in range(128)</span>
</pre></div>
</div>
</li>
</ol>
<p>See <a class="reference external" href="http://stackoverflow.com/questions/809796/any-gotchas-using-unicode-literals-in-python-2-6">this Stack Overflow thread</a>
for other gotchas.</p>
</section>
<section id="others-perspectives">
<h2>Others’ perspectives<a class="headerlink" href="#others-perspectives" title="Link to this heading">¶</a></h2>
<section id="in-favour-of-unicode-literals">
<h3>In favour of <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code><a class="headerlink" href="#in-favour-of-unicode-literals" title="Link to this heading">¶</a></h3>
<p>Django recommends importing <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> as its top <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/python3/#unicode-literals">porting tip</a> for
migrating Django extension modules to Python 3.  The following <a class="reference external" href="https://groups.google.com/forum/#!topic/django-developers/2ddIWdicbNY">quote</a> is
from Aymeric Augustin on 23 August 2012 regarding why he chose
<code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> for the port of Django to a Python 2/3-compatible
codebase.:</p>
<blockquote>
<div><p>“… I’d like to explain why this PEP [PEP 414, which allows explicit
<code class="docutils literal notranslate"><span class="pre">u''</span></code> prefixes for unicode literals on Python 3.3+] is at odds with
the porting philosophy I’ve applied to Django, and why I would have
vetoed taking advantage of it.</p>
<p>“I believe that aiming for a Python 2 codebase with Python 3
compatibility hacks is a counter-productive way to port a project. You
end up with all the drawbacks of Python 2 (including the legacy <cite>u</cite>
prefixes) and none of the advantages Python 3 (especially the sane
string handling).</p>
<p>“Working to write Python 3 code, with legacy compatibility for Python
2, is much more rewarding. Of course it takes more effort, but the
results are much cleaner and much more maintainable. It’s really about
looking towards the future or towards the past.</p>
<p>“I understand the reasons why PEP 414 was proposed and why it was
accepted. It makes sense for legacy software that is minimally
maintained. I hope nobody puts Django in this category!”</p>
</div></blockquote>
</section>
<section id="against-unicode-literals">
<h3>Against <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code><a class="headerlink" href="#against-unicode-literals" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>“There are so many subtle problems that <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> causes.
For instance lots of people accidentally introduce unicode into
filenames and that seems to work, until they are using it on a system
where there are unicode characters in the filesystem path.”</p>
<p class="attribution">—Armin Ronacher</p>
</div></blockquote>
<blockquote>
<div><p>“+1 from me for avoiding the unicode_literals future, as it can have
very strange side effects in Python 2…. This is one of the key
reasons I backed Armin’s PEP 414.”</p>
<p class="attribution">—Nick Coghlan</p>
</div></blockquote>
<blockquote>
<div><p>“Yeah, one of the nuisances of the WSGI spec is that the header values
IIRC are the str or StringType on both py2 and py3. With
unicode_literals this causes hard-to-spot bugs, as some WSGI servers
might be more tolerant than others, but usually using unicode in python
2 for WSGI headers will cause the response to fail.”</p>
<p class="attribution">—Antti Haapala</p>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/python-future-logo-textless-transparent.png" alt="Logo"/>
            </a></p>
  
<!--<h3>Python-Future</h3>
<p>-->
  <h4>Easy, clean, reliable Python 2/3 compatibility</h4>
  <a href="https://python-future.org/#contents">Table of Contents</a>
<!--
</p>
<h3>Other Formats</h3>
<p>
  You can download the documentation in other formats as well:
</p>
<ul>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.pdf">as PDF</a>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.zip">as zipped HTML</a>
</ul>
-->
<!--<h3>Useful Links</h3>
<ul>
  <li><a href="https://pypi.org/project/future/">on PyPI</a></li>
  <li><a href="https://github.com/PythonCharmers/python-future">on GitHub</a></li>
</ul>
--><ul>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview: Easy, clean, reliable Python 2/3 compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick-start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatible_idioms.html">Cheat Sheet: Writing Python 2-3 compatible code</a></li>
<li class="toctree-l1"><a class="reference internal" href="imports.html">Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_else.html">What else you need to know</a></li>
<li class="toctree-l1"><a class="reference internal" href="automatic_conversion.html">Automatic conversion to Py2/3</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib_incompatibilities.html">Standard library incompatibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="older_interfaces.html">Older interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes in previous versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Licensing and credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference (in progress)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2019, Python Charmers Pty Ltd, Australia.
    </div>
  <script src="_static/version_warning_offset.js"></script>

<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>