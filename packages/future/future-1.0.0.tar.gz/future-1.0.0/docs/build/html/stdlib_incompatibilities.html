
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Standard library incompatibilities &#8212; Python-Future  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/jinja.css?v=85659ec6" />
    <link rel="stylesheet" href="_static/my-styles.css" type="text/css" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="_static/python-future-icon-32.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Older interfaces" href="older_interfaces.html" />
    <link rel="prev" title="Frequently Asked Questions (FAQ)" href="faq.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19344199-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="older_interfaces.html" title="Older interfaces"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions (FAQ)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Python-Future  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Standard library incompatibilities</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="standard-library-incompatibilities">
<span id="stdlib-incompatibilities"></span><h1>Standard library incompatibilities<a class="headerlink" href="#standard-library-incompatibilities" title="Link to this heading">¶</a></h1>
<p>Some standard library interfaces have changed in ways that require
different code than normal Py3 code in order to achieve Py2/3
compatibility.</p>
<p>Here we will attempt to document these, together with known workarounds:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Standard library incompatibilities</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 22.2%" />
<col style="width: 44.4%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>module</p></th>
<th class="head"><p>object / feature</p></th>
<th class="head"><p>section</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">array</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array</span></code> constructor</p></td>
<td><p><a class="reference internal" href="#stdlib-array-constructor"><span class="std std-ref">array.array()</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">array</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array.read()</span></code> method</p></td>
<td><p><a class="reference internal" href="#stdlib-array-read"><span class="std std-ref">array.array.read()</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">base64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">decodebytes()</span></code> function</p></td>
<td><p><a class="reference internal" href="#stdlib-base64-decodebytes"><span class="std std-ref">base64.decodebytes() and base64.encodebytes()</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">re</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ASCII</span></code> mode</p></td>
<td><p><a class="reference internal" href="#stdlib-re-ascii"><span class="std std-ref">re.ASCII</span></a></p></td>
</tr>
</tbody>
</table>
<p>To contribute to this list, please send a pull request. See <a class="reference internal" href="faq.html#contributing"><span class="std std-ref">Contributing</span></a>.</p>
<section id="array-array">
<span id="stdlib-array-constructor"></span><h2>array.array()<a class="headerlink" href="#array-array" title="Link to this heading">¶</a></h2>
<p>The first argument to <code class="docutils literal notranslate"><span class="pre">array.array(typecode[,</span> <span class="pre">initializer])</span></code> must be a native
platform string: unicode string on Python 3, byte string on Python 2.</p>
<dl>
<dt>Python 2::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="go">array.array(b&#39;b&#39;)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
<span class="go">TypeError: must be char, not unicode</span>
</pre></div>
</div>
</dd>
<dt>Python 3::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="go">TypeError: must be a unicode character, not bytes</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="go">array(&#39;b&#39;)</span>
</pre></div>
</div>
</dd>
</dl>
<p>This means that the typecode cannot be specified portably across Python 3 and Python 2
with a single string literal when <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code> is in effect.</p>
<p>You can use the following code on both Python 3 and Python 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">bytes_to_native_str</span>
<span class="kn">import</span> <span class="nn">array</span>

<span class="c1"># ...</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bytes_to_native_str</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This was <a class="reference external" href="https://hg.python.org/cpython/file/6d1b6a68f775/Misc/NEWS#l233">fixed in Python 2.7.11</a>.
Since then, <code class="docutils literal notranslate"><span class="pre">array.array()</span></code> now also accepts unicode format typecode.</p>
</section>
<section id="array-array-read">
<span id="stdlib-array-read"></span><h2>array.array.read()<a class="headerlink" href="#array-array-read" title="Link to this heading">¶</a></h2>
<p>This method has been removed in Py3. This crops up in e.g. porting <code class="docutils literal notranslate"><span class="pre">http.client</span></code>.</p>
</section>
<section id="base64-decodebytes-and-base64-encodebytes">
<span id="stdlib-base64-decodebytes"></span><h2>base64.decodebytes() and base64.encodebytes()<a class="headerlink" href="#base64-decodebytes-and-base64-encodebytes" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">base64</span></code> module on Py2 has no <code class="docutils literal notranslate"><span class="pre">decodebytes</span></code> or <code class="docutils literal notranslate"><span class="pre">encodebytes</span></code> functions.</p>
</section>
<section id="re-ascii">
<span id="stdlib-re-ascii"></span><h2>re.ASCII<a class="headerlink" href="#re-ascii" title="Link to this heading">¶</a></h2>
<p>Python 3 code using regular expressions sometimes looks like this (from
<a class="reference external" href="https://docs.python.org/3/library/urllib.request.html#module-urllib.request" title="(in Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.request</span></code></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;:\d+$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
</pre></div>
</div>
<p>This enables ‘ASCII mode’ for regular expressions (see the docs <a class="reference external" href="http://docs.python.org/3/library/re.html#re.ASCII">here</a>). Python 2’s
<a class="reference external" href="https://docs.python.org/3/library/re.html#module-re" title="(in Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> module has no equivalent mode.</p>
</section>
<section id="struct-pack">
<h2>struct.pack()<a class="headerlink" href="#struct-pack" title="Link to this heading">¶</a></h2>
<p>Before Python version 2.7.7, the <a class="reference external" href="https://docs.python.org/3/library/struct.html#struct.pack" title="(in Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">struct.pack()</span></code></a> function
required a native string as its format argument. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;4H2I&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">rec_type</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">file_hist_flags</span><span class="p">,</span> <span class="n">ver_can_read</span><span class="p">)</span>
</pre></div>
</div>
<p>raised <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">Struct()</span> <span class="pre">argument</span> <span class="pre">1</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">string,</span> <span class="pre">not</span> <span class="pre">unicode</span></code>.</p>
<p>This was <a class="reference external" href="https://hg.python.org/cpython/raw-file/f89216059edf/Misc/NEWS">fixed in Python 2.7.7</a>.
Since then, <code class="docutils literal notranslate"><span class="pre">struct.pack()</span></code> now also accepts unicode format
strings.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/python-future-logo-textless-transparent.png" alt="Logo"/>
            </a></p>
  
<!--<h3>Python-Future</h3>
<p>-->
  <h4>Easy, clean, reliable Python 2/3 compatibility</h4>
  <a href="https://python-future.org/#contents">Table of Contents</a>
<!--
</p>
<h3>Other Formats</h3>
<p>
  You can download the documentation in other formats as well:
</p>
<ul>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.pdf">as PDF</a>
  <li><a href="http://jinja.pocoo.org/docs/jinja-docs.zip">as zipped HTML</a>
</ul>
-->
<!--<h3>Useful Links</h3>
<ul>
  <li><a href="https://pypi.org/project/future/">on PyPI</a></li>
  <li><a href="https://github.com/PythonCharmers/python-future">on GitHub</a></li>
</ul>
--><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview: Easy, clean, reliable Python 2/3 compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick-start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatible_idioms.html">Cheat Sheet: Writing Python 2-3 compatible code</a></li>
<li class="toctree-l1"><a class="reference internal" href="imports.html">Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_else.html">What else you need to know</a></li>
<li class="toctree-l1"><a class="reference internal" href="automatic_conversion.html">Automatic conversion to Py2/3</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Standard library incompatibilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#array-array">array.array()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#array-array-read">array.array.read()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#base64-decodebytes-and-base64-encodebytes">base64.decodebytes() and base64.encodebytes()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#re-ascii">re.ASCII</a></li>
<li class="toctree-l2"><a class="reference internal" href="#struct-pack">struct.pack()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="older_interfaces.html">Older interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes in previous versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Licensing and credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference (in progress)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2019, Python Charmers Pty Ltd, Australia.
    </div>
  <script src="_static/version_warning_offset.js"></script>

<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>